---
import '../styles/global.css';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import AdSlot from '../components/AdSlot.astro';
import SEO from '../components/SEO.astro';

interface Props {
  title: string;
  description?: string;
  image?: string;
  ogImage?: string;
  showHeaderAd?: boolean;
  showFooterAd?: boolean;
  ignoreSiteName?: boolean;
}

const { 
  title, 
  description = "Narzo - Marketplace Produk Digital Universal & Terpercaya",
  image,
  ogImage,
  showHeaderAd = true,
  showFooterAd = true,
  ignoreSiteName = false
} = Astro.props;

// Use ogImage if provided, otherwise fall back to image or default
const finalOgImage = ogImage || image;

const adsenseId = import.meta.env.ADSENSE_PUBLISHER_ID;
const adsEnabled = import.meta.env.ADSENSE_ENABLED === 'true';
---

<!DOCTYPE html>
<html lang="id" class="dark">
<head>
  <SEO title={title} description={description} image={finalOgImage} ignoreSiteName={ignoreSiteName} />
  
  <!-- Extra head content (for schema etc) -->
  <slot name="head" />
  
  <!-- Preconnect & DNS Prefetch -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="preconnect" href="https://images.unsplash.com" />
  <link rel="dns-prefetch" href="https://images.unsplash.com" />
  
  <!-- Google Fonts - Preload for faster LCP -->
  <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" media="print" onload="this.media='all'" />
  <noscript>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" />
  </noscript>
  
  <!-- Adsense (only if configured) -->
  {adsEnabled && adsenseId && (
    <script async 
      src={`https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=${adsenseId}`}
      crossorigin="anonymous">
    </script>
  )}
</head>
<body class="min-h-screen flex flex-col text-gray-100 selection:bg-accent selection:text-white">
  <Header />
  
  <!-- Header Ad -->
  {showHeaderAd && (
    <div class="container mx-auto px-4 py-2">
      <AdSlot slot="header" />
    </div>
  )}
  
  <main class="flex-1">
    <slot />
  </main>
  
  <!-- Footer Ad -->
  {showFooterAd && (
    <div class="container mx-auto px-4 py-2">
      <AdSlot slot="footer" />
    </div>
  )}
  
  <Footer />
</body>
</html>