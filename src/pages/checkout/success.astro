
---
// src/pages/checkout/success.astro
import BaseLayout from '../../layouts/BaseLayout.astro';

const txId = Astro.url.searchParams.get('id');
const db = Astro.locals.runtime.env.DB;

let tx = null;
if (txId) {
  tx = await db.prepare(
    'SELECT * FROM transactions WHERE id = ?'
  ).bind(txId).first();
}
---

<BaseLayout title="Payment" showHeaderAd={false} showFooterAd={false}>
  <div class="container mx-auto px-4 py-24 text-center">
    {tx?.status === 'paid' ? (
      <>
        <div class="text-6xl mb-6">✅</div>
        <h1 class="text-3xl font-bold mb-4">Payment Successful!</h1>
        <p class="text-gray-400 mb-8">
          Thank you for your purchase. Check your email for details.
        </p>
      </>
    ) : (
      <>
        <div class="text-6xl mb-6">⏳</div>
        <h1 class="text-3xl font-bold mb-4">Processing...</h1>
        <p class="text-gray-400 mb-8">
          Your payment is being processed. This page will update automatically.
        </p>
        <script is:inline>
          setTimeout(() => location.reload(), 5000);
        </script>
      </>
    )}
    
    <a href="/" class="btn-primary inline-block">Back to Home</a>
  </div>
</BaseLayout>
